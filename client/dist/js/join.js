const form=document.querySelector("form"),submitBtn=document.querySelector(".submit"),continueBtn=document.querySelector(".continue"),loading=document.querySelector(".loading"),warning=document.querySelector(".warning"),hasaccount=document.querySelector(".hasaccount"),url="http://127.0.0.1:4010/";async function btnHandler(n){if(n.preventDefault(),n.target===continueBtn&&(window.sessionStorage.email="",auth()),n.target===submitBtn){warning.style.display="none";let t="";const s=new FormData(form);var a=s.get("accountName"),o=s.get("password"),i=s.get("confirm_password");const r=new RegExp(/^\S*(?=\S{6,})(?=\S*\d)(?=\S*[A-Z])(?=\S*[a-z])(?=\S*[\.!@#$%^&*? ])\S*$/);r.test(o)||(t+="密码格式错误，请重新检查后输入。</br>"),o?o!==i&&(t+="请在两个密码字段中输入相同的内容。</br>"):t+="请正确填写密码。</br>";let e=await fetch(url+"auth/name",{method:"POST",body:JSON.stringify({name:a}),headers:{"Content-Type":"application/json"}});if((e=await e.json()).result||(t+="用户名重复,请输入其他用户名。</br>"),""===t?warning.style.display="none":warning.style.display="block",!(warning.innerHTML=t)){n.target.parentElement.style.display="none",loading.style.display="block";let t=await fetch(url+"signup/join",{method:"POST",body:s});(t=await t.json()).result&&setTimeout(()=>{location.href="../html/signin.html"},2e3*Math.random()+2e3)}}}async function auth(){let t=await fetch(url+"auth",{method:"post",body:JSON.stringify({email:window.sessionStorage.email}),headers:{"Content-Type":"application/json"}});(t=await t.json()).result?(hasaccount.style.display="block",form.style.display="none"):(hasaccount.style.display="none",form.style.display="block")}submitBtn.addEventListener("click",btnHandler),continueBtn.addEventListener("click",btnHandler),auth();